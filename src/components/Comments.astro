---
// src/components/Comments.astro
interface Props {
  title: string;
  url: string;
  id: string;
}

const { title, url, id } = Astro.props;
---

<div class="comments-container">
  <h3>Comments</h3>
  
  <div id="cusdis_thread"
    data-host="https://cusdis.com"
    data-app-id="21cb39d0-3721-4efc-94f6-abc2e674f67b"
    data-page-id={id}
    data-page-url={url}
    data-page-title={title}
  ></div>
  
</div>

<script src="https://cusdis.com/js/cusdis.es.js"></script>

<script is:inline>
  window.addEventListener('message', function (e) {
    if (e.origin === 'https://cusdis.com') {
      try {
        const data = JSON.parse(e.data);
        if (data.height) {
          const iframe = document.querySelector('#cusdis_thread iframe');
          if (iframe) {
            iframe.style.height = data.height + 'px';
          }
        }
      } catch (err) {
        // Ignore non-JSON messages
      }
    }
  });
</script>

<style>
  .comments-container {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-border);
  }
  .comments-container h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: var(--color-text-darker);
  }
  
  /* Force the Cusdis iframe to look correct */
  :global(#cusdis_thread iframe) {
    width: 100% !important;
    border: none !important;
    display: block !important;
    /* Start with a reasonable height to prevent jumpiness */
    min-height: 400px; 
  }
</style>