---
// src/pages/index.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import RecipeCard from '../components/RecipeCard.astro';
import { getCollection } from 'astro:content';

// 1. Astro වලට කියනවා 'recipes' collection එකෙන් data ගේන්න කියලා
// අපි draft විදිහට publish කරන්න අකමැති ඒවා filter කරනවා (දැනට publishDate එකෙන්)
const allRecipes = await getCollection('recipes', ({ data }) => {
  return data.publishDate <= new Date(); // අද දවසට වඩා පරණ ඒවා විතරක් පෙන්නන්න
});

// 2. අලුත්ම recipe එක උඩින්ම එන්න sort කරනවා
allRecipes.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

// 3. Featured Recipes ටික filter කරගන්නවා
// Markdown file එකේ isFeatured: true කියලා දාපුවා විතරක්
const featuredRecipes = allRecipes.filter(({ data }) => data.isFeatured);

// 4. Homepage එකට අදාළ SEO details
const seoProps = {
  title: 'Home | My Awesome Recipe Site',
  description: 'Find the best, simple, and delicious recipes for your weeknight dinners and impress your family.'
};
---
<style>
  .hero-section {
    /* ලස්සන Gradient Background එකක් */
    background: linear-gradient(135deg, #FF6B6B 0%, #FFB88C 100%);
    border-radius: 12px;
    padding: 5rem 2rem; /* ලොකු padding එකක් */
    text-align: center;
    color: white;
    box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
  }
  .hero-title {
    font-size: 3.5rem; /* 3.5rem */
    font-weight: 900;
    color: white;
    line-height: 1.2;
  }
  .hero-subtitle {
    font-size: 1.15rem;
    color: white;
    opacity: 0.9;
    max-width: 600px;
    margin: 1rem auto 0;
  }

  .section-title {
    font-size: 2.2rem;
    font-weight: 700;
    margin-top: 3.5rem;
    margin-bottom: 2rem;
    border-bottom: 3px solid var(--color-primary);
    padding-bottom: 0.5rem;
    display: inline-block;
  }

  .recipe-grid {
    display: grid;
    /* Mobile එකේ 1 column, 
      Tablet එකේ 2 columns,
      PC එකේ 3 columns 
      වෙන්න හදන simple responsive grid එක 
    */
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
  }
</style>

<BaseLayout seo={seoProps}>

  <section class="hero-section">
    <h1 class="hero-title">Delicious Recipes for Everyone</h1>
    <p class="hero-subtitle">
      Welcome to your new favorite food site. Find simple, tasty, and 
      USA-audience-approved recipes for every occasion.
    </p>
  </section>

  {featuredRecipes.length > 0 && (
    <section class="featured-recipes">
      <h2 class="section-title">Featured Recipes</h2>
      <div class="recipe-grid">
        {featuredRecipes.map(recipe => (
          <RecipeCard recipe={recipe} />
        ))}
      </div>
    </section>
  )}
  

  <section class="all-recipes" id="all-recipes"> 
    <h2 class="section-title">All Recipes</h2>
    <div class="recipe-grid">
      {allRecipes.map(recipe => (
        <RecipeCard recipe={recipe} />
      ))}
    </div>
  </section>

</BaseLayout>